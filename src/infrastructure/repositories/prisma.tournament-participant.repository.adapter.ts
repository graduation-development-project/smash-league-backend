import { BadRequestException, Injectable } from "@nestjs/common";

import { PrismaService } from "../services/prisma.service";
import { TournamentParticipantsRepositoryPort } from "../../domain/repositories/tournament-participant.repository.port";
import {
	MatchStatus,
	TournamentParticipants,
	TournamentRegistrationRole,
	TournamentRegistrationStatus,
} from "@prisma/client";

@Injectable()
export class PrismaTournamentParticipantRepositoryAdapter
	implements TournamentParticipantsRepositoryPort
{
	constructor(private prismaService: PrismaService) {}

	async addTournamentParticipant(
		tournamentId: string,
		tournamentEventId: string,
		playerId: string,
		partnerId?: string,
	): Promise<TournamentParticipants> {
		try {
			return this.prismaService.tournamentParticipants.create({
				data: {
					tournamentEventId,
					userId: playerId,
					tournamentId,
					partnerId,
				},
			});
		} catch (e) {
			console.error("Error adding tournament participant", e);
			throw e;
		}
	}

	async getParticipantInTournament(
		tournamentId: string,
		userId: string,
	): Promise<TournamentParticipants[]> {
		try {
			return this.prismaService.tournamentParticipants.findMany({
				where: {
					userId,
					tournamentId,
				},
			});
		} catch (e) {
			console.error("Error getParticipantInTournament", e);
			throw e;
		}
	}

	async getEventParticipantList(
		tournamentId: string,
		tournamentEventId: string,
	): Promise<TournamentParticipants[]> {
		try {
			return this.prismaService.tournamentParticipants.findMany({
				where: {
					tournamentId,
					tournamentEventId,
				},
			});
		} catch (e) {
			console.error("Error getParticipantInTournament", e);
			throw e;
		}
	}

	async getTournamentParticipantDetail(
		id: string,
	): Promise<TournamentParticipants> {
		try {
			return this.prismaService.tournamentParticipants.findUnique({
				where: { id },
				include: {
					user: true,
				},
			});
		} catch (e) {
			console.error("Error getTournamentParticipantDetail", e);
			throw e;
		}
	}

	async seedParticipants(
		tournamentId: string,
		tournamentEventId: string,
	): Promise<void> {
		const tournamentExists = await this.prismaService.tournament.findUnique({
			where: { id: tournamentId },
		});
		if (!tournamentExists) {
			throw new BadRequestException(
				`Tournament with ID "${tournamentId}" not found.`,
			);
		}

		// Check if the tournament event exists
		const tournamentEventExists =
			await this.prismaService.tournamentEvent.findUnique({
				where: { id: tournamentEventId },
			});
		if (!tournamentEventExists) {
			throw new BadRequestException(
				`TournamentEvent with ID "${tournamentEventId}" not found.`,
			);
		}

		const participants =
			await this.prismaService.tournamentParticipants.findMany({
				where: {
					tournamentId,
					tournamentEventId,
				},
			});

		const existingParticipantIds = participants.map((p) => p.userId);

		const takeNumber =
			tournamentEventExists.maximumAthlete - participants.length;

		// Check if all provided user IDs exist
		const existingUsers = await this.prismaService.user.findMany({
			where: {
				id: {
					notIn: existingParticipantIds,
				},
				userRoles: {
					none: {
						role: {
							roleName: { in: ["Staff", "Admin", "Umpire"] },
						},
					},
				},
			},
			take: takeNumber,
		});

		console.log(existingUsers.map((item) => item.name));
		const registrationsToCreate = existingUsers.map((userId) => ({
			tournamentId,
			tournamentEventId,
			userId: userId.id,
			registrationDocumentCreator: [
				"data:image/jpeg;base64,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",
				"data:image/jpeg;base64,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",
				"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ6ZwRnV2fTxYgRUw4ORR-gzwCdvCACBtOcyg&s",
			],
			status: TournamentRegistrationStatus.APPROVED,
			registrationRole: TournamentRegistrationRole.ATHLETE,
		}));

		const participantsToCreate = existingUsers.map((userId) => ({
			tournamentId,
			tournamentEventId,
			userId: userId.id,
		}));

		await this.prismaService.tournamentRegistration.createMany({
			data: registrationsToCreate,
		});

		const createdParticipants =
			await this.prismaService.tournamentParticipants.createMany({
				data: participantsToCreate,
			});

		return;
	}

	async banParticipant(
		participantId: string,
		tournamentId: string,
	): Promise<void> {
		await this.prismaService.tournamentParticipants.update({
			where: {
				id: participantId,
			},

			data: {
				isBanned: true,
			},
		});

		const matches = await this.prismaService.match.findMany({
			where: {
				OR: [
					{ leftCompetitorId: participantId },
					{ rightCompetitorId: participantId },
				],
				tournamentEvent: {
					tournament: {
						id: tournamentId,
					},
				},
			},
		});

		for (const match of matches) {
			const hasPlayed = match.timeEnd !== null;

			const fullPlayer =
				match.leftCompetitorId !== null && match.rightCompetitorId !== null;

			if (!hasPlayed && !fullPlayer) {
				await this.prismaService.match.update({
					where: { id: match.id },
					data: {
						forfeitCompetitorId: participantId,
					},
				});
			}

			if (!hasPlayed && fullPlayer) {
				const winnerId =
					match.leftCompetitorId !== participantId
						? match.leftCompetitorId
						: match.rightCompetitorId;

				await this.prismaService.match.update({
					where: { id: match.id },
					data: {
						forfeitCompetitorId: participantId,
						matchWonByCompetitorId: winnerId,
						matchStatus: MatchStatus.ENDED,
					},
				});
			}
		}

		return
	}
}
