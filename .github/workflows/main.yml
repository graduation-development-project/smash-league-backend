name: backend-service-deployment

on: 
  push:
    branches: 
      main
      
jobs:
  docker-compose: 
    runs-on: self-hosted
    environment: docker
    steps:
    - name: Checkout Code
      uses: actions/checkout@v2
    - name: Execute "drop docker volume" before building
      run: |
        docker stop database
        docker rm database
        docker volume rm smash-league-backend_postgres_data
        docker container stop smash_league_api
        docker container rm smash_league_api
        docker volume rm smash-league-backend_backend_service
    - name: Run "database"
      run: docker compose up -d db 
    - name: Run "docker compose"
      run: docker compose up --build -d api
